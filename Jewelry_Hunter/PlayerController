using System.Collections;
using System.Collections.Generic;
using UnityEngine;

public class PlayerController: MonoBehaviour
{

  Rigidbody2D rbody;
  float axisH = 0.0f;
  public float speed = 3.0f;
  
  public float jump = 9.0f
  public LayerMask groundLayer;
  bool goJump = false;
  bool onGround = false;
  
  Animator animator;
  public string stopAnime = "PlayerStop";
  public string moveAnime = "PlayerMove";
  public string jumpAnime = "PlayerJump";
  public string goalAnime = "PlayerGoal";
  public string deadAnime = "PlayerDead";
  string nowAnime = "";
  string oldAnime = "";
  
  void Start()
  {
    rbody = this.GetComponent<Rigidbody2D>(); //this는 자기자신을 나타내지만 생략 가능함
    animator = GetComponent<Animator>();
    nowAnime = stopAnime;
    oldAnime = stopAnime;
  }
  
  void Update() //수평 방향 입력 체크
  {
    axisH = Input.GetAxisRaw("Horizontal");
    
    if(axisH > 0.0f)  //오른쪽으로 이동
    {
      transform.localScale = new Vector2(1,1);
    }
    
    eles if(axisH < 0.0f) //왼쪽으로 이동
    {
      transform.localScale = new Vector2(-1,1);
    }
    
    if(Input.GetButtonDown("Jump")
    {
      Jump();
    }
      
  }
  
  void FixedUpdate()  //속도 갱신 메서드
  {
    onGround = Physics2D.Linecast(transform.position, transform.position - (transform.up * 0.1f), groundLayer);
    //  착지 판정
    
    if(onGround || axisH != 0)
    {
      rbody.velocity = new Vector2(axisH * speed, rbody.velocity.y);
    }
    
    if(onGround && goJump)
    {
      Vector2 jumpPw = new Vectro2(0, jump);  //점프를 위한 벡터 생성
      rbody.AddForce(jumpPw, ForceMode2D.Impulse);  // 순간적인 힘 가하기
      goJump = false;
    }
    
    if(onGround)
    {
      if(axisH == 0)  //지면 위일때
      {
        nowAnime = stopAnime; //stopanime 재생 둘중 하나
      }
      else
      {
        nowAnime = moveAnime; //moveanime 재생 둘중 하나
      }
     else
     {
        nowAnime = jumpAnime; //지면이 아닐 경우 jumpanime 실행
     }
     
     if(nowAnime != oldAnime)
     {
        oldAnime = nowAnime;
        animator.Play(nowAnime);
     }
    
  }

  public void Jump()
  {
    goJump = true;
  }
  
  private void OnTriggerEnter2D(Collider2D collision)
  {
    if(collision.gameObject.tag == "Goal")
    {
      Goal();
    }
    else if(collision.gameObject.tag == "Dead")
    {
      GameOver();
    }
  }
  
  public void Goal()
  {
    animator.Play(goalAnime);
  }
  
  public void GameOver()
  {
    animator.Play(deadAnime);
  }  
  
}
